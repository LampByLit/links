<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Card Links for X.com</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Test deployment - absolute path persistence check -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        function UploadForm() {
            const [image, setImage] = useState(null);
            const [link, setLink] = useState('');
            const [title, setTitle] = useState('');
            const [previewUrl, setPreviewUrl] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const previewRef = React.useRef(null);

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    setImage(file);
                }
            };


            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (!image || !link) {
                    alert('Please upload an image and provide a link');
                    return;
                }

                setIsLoading(true);
                const formData = new FormData();
                formData.append('image', image);
                formData.append('link', link);
                formData.append('title', title);

                try {
                    const response = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (result.success) {
                        setPreviewUrl(result.previewUrl);
                        // Reset form
                        setImage(null);
                        setLink('');
                        setTitle('');
                        document.querySelector('input[type="file"]').value = '';
                        
                        // Smooth scroll to preview section
                        setTimeout(() => {
                            previewRef.current?.scrollIntoView({ 
                                behavior: 'smooth',
                                block: 'start'
                            });
                        }, 100);
                    } else {
                        alert(`Error: ${result.error}`);
                    }
                } catch (error) {
                    console.error('Upload error:', error);
                    alert('Failed to upload. Please try again.');
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-gray-50 flex items-center justify-center pt-6 pb-12 px-4 sm:px-6 lg:px-8">
                    <div className="max-w-md w-full space-y-8">
                        <div>
                            {/* Logo */}
                            <div className="flex justify-center mb-6">
                                <a 
                                    href="https://lampbylit.com" 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    className="hover:opacity-80 transition-opacity"
                                >
                                    <img 
                                        src="/images/logo.png" 
                                        alt="&amp Logo" 
                                        className="h-24 w-auto"
                                        style={{
                                            imageRendering: 'auto',
                                            imageRendering: '-webkit-optimize-contrast',
                                            imageRendering: 'optimize-contrast',
                                            imageRendering: 'smooth'
                                        }}
                                    />
                                </a>
                            </div>
                            
                            <h2 className="mt-6 text-center text-2xl font-semibold text-gray-900" style={{fontFamily: 'Inter, sans-serif'}}>
                                Create a Clickable Image for X.com
                            </h2>
                            <p className="mt-2 text-justify text-sm text-gray-600">
                                Upload an image and add your URL to generate a link that when posted on X.com will display as a clickable image that redirects to your URL. After posting the link on X.com, wait 30 seconds for the clickable image to appear.<br/><span className="text-red-600 font-medium">All images are automatically adjusted to 1200x600px.</span><br/><a target="_blank" href="https://tco.up.railway.app/links">Click here to see a list of all generated links.</a>
                            </p>
                        </div>
                        <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
                            <div className="space-y-4">
                                {/* Image Upload */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700">
                                        Upload Image
                                    </label>
                                    <input
                                        type="file"
                                        accept="image/*"
                                        onChange={handleImageUpload}
                                        className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                    />
                                </div>

                                {/* Link Input */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700">
                                        Destination Link
                                    </label>
                                    <input
                                        type="url"
                                        value={link}
                                        onChange={(e) => setLink(e.target.value)}
                                        placeholder="https://example.com"
                                        className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                        required
                                    />
                                </div>

                                {/* Title Input */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700">
                                        Title (Optional)
                                    </label>
                                    <input
                                        type="text"
                                        value={title}
                                        onChange={(e) => setTitle(e.target.value)}
                                        placeholder="Your card title"
                                        className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                    />
                                </div>

                            </div>


                            <div>
                                <button
                                    type="submit"
                                    disabled={isLoading}
                                    className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {isLoading ? 'Creating Card...' : 'Generate Custom Card Link'}
                                </button>
                            </div>
                        </form>
                        
                        {/* Preview Section */}
                        {previewUrl && (
                            <div ref={previewRef} className="mt-8 p-6 bg-white rounded-lg shadow-md border border-gray-200">
                                <h3 className="text-lg font-semibold text-gray-900 mb-4">Your Card is Ready!</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Share this URL:
                                        </label>
                                        <div className="flex">
                                            <input
                                                type="text"
                                                value={previewUrl}
                                                readOnly
                                                className="flex-1 px-3 py-2 border border-gray-300 rounded-l-md bg-gray-50 text-sm"
                                            />
                                            <button
                                                onClick={() => {
                                                    // Use execCommand to avoid permission popups
                                                    const textArea = document.createElement('textarea');
                                                    textArea.value = previewUrl;
                                                    textArea.style.position = 'fixed';
                                                    textArea.style.left = '-999999px';
                                                    textArea.style.top = '-999999px';
                                                    document.body.appendChild(textArea);
                                                    textArea.focus();
                                                    textArea.select();
                                                    
                                                    try {
                                                        document.execCommand('copy');
                                                        // Show visual feedback without popup
                                                        const button = event.target;
                                                        const originalText = button.textContent;
                                                        button.textContent = 'Copied!';
                                                        button.classList.add('bg-green-600');
                                                        setTimeout(() => {
                                                            button.textContent = originalText;
                                                            button.classList.remove('bg-green-600');
                                                        }, 1500);
                                                    } catch (err) {
                                                        console.error('Copy failed:', err);
                                                    } finally {
                                                        document.body.removeChild(textArea);
                                                    }
                                                }}
                                                className="px-4 py-2 bg-blue-600 text-white rounded-r-md hover:bg-blue-700 text-sm transition-colors"
                                            >
                                                Copy
                                            </button>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => setPreviewUrl('')}
                                        className="w-full py-2 px-4 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"
                                    >
                                        Create Another Link
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function App() {
            return <UploadForm />;
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
